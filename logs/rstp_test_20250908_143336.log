2025-09-08 14:33:36,789 - root - INFO - 日志系统初始化完成，日志文件: logs\rstp_test_20250908_143336.log
2025-09-08 14:33:36,997 - SSH_DUT - INFO - SSH连接成功: DUT (192.168.1.123)
2025-09-08 14:33:36,998 - RSTPTest - INFO - 成功连接到DUT: DUT
2025-09-08 14:33:37,342 - SSH_TestNode1 - INFO - SSH连接成功: TestNode1 (192.168.13.136)
2025-09-08 14:33:37,342 - RSTPTest - INFO - 成功连接到节点: TestNode1
2025-09-08 14:33:37,647 - SSH_TestNode2 - INFO - SSH连接成功: TestNode2 (192.168.13.137)
2025-09-08 14:33:37,647 - RSTPTest - INFO - 成功连接到节点: TestNode2
2025-09-08 14:33:37,648 - RSTPTest - INFO - ============================================================
2025-09-08 14:33:37,648 - RSTPTest - INFO - 开始测试: test_rstp_protocol_verification
2025-09-08 14:33:37,649 - RSTPTest - INFO - ============================================================
2025-09-08 14:33:37,650 - test_protocol_conformance - INFO - 开始RSTP协议验证
2025-09-08 14:33:37,650 - test_protocol_conformance - INFO - === 诊断并修复DUT网桥配置 ===
2025-09-08 14:33:37,660 - test_protocol_conformance - INFO - OVS配置:
8c812ea9-3b0c-46a1-bd3c-ef3904d38c1a
    Bridge SE_ETH4
        Port SE_ETH4
            Interface SE_ETH4
                type: internal
    Bridge SE_ETH6
        Port SE_ETH6
            Interface SE_ETH6
                type: internal
    Bridge rstp0
        Port rstp0
            Interface rstp0
                type: internal
    Bridge br0
        Port eth0
            Interface eth0
                error: "could not open network device eth0 (No such device)"
        Port br0
            
2025-09-08 14:33:37,662 - test_protocol_conformance - INFO - 检测到OVS网桥: rstp0
2025-09-08 14:33:37,711 - test_protocol_conformance - INFO - 当前 rstp0 端口: []
2025-09-08 14:33:37,711 - test_protocol_conformance - WARNING - 网桥 rstp0 没有端口！需要添加端口
2025-09-08 14:33:37,761 - test_protocol_conformance - INFO - 发现SE_ETH接口: ['SE_ETH1', 'SE_ETH4', 'SE_ETH2', 'SE_ETH6']
2025-09-08 14:33:37,965 - test_protocol_conformance - INFO - 尝试添加接口 SE_ETH1 到网桥 rstp0
2025-09-08 14:33:38,077 - test_protocol_conformance - INFO - ✓ 成功添加端口 SE_ETH1
2025-09-08 14:33:38,232 - test_protocol_conformance - INFO - 尝试添加接口 SE_ETH4 到网桥 rstp0
2025-09-08 14:33:38,340 - test_protocol_conformance - WARNING - ✗ 无法添加端口 SE_ETH4: ovs-vsctl: cannot create a port named SE_ETH4 because a bridge named SE_ETH4 already exists

2025-09-08 14:33:38,388 - test_protocol_conformance - INFO - 尝试添加接口 SE_ETH2 到网桥 rstp0
2025-09-08 14:33:38,492 - test_protocol_conformance - WARNING - ✗ 无法添加端口 SE_ETH2: ovs-vsctl: cannot create a port named SE_ETH2 because a bridge named SE_ETH2 already exists

2025-09-08 14:33:38,493 - test_protocol_conformance - INFO - 已添加端口到网桥: ['SE_ETH1']
2025-09-08 14:33:38,548 - test_protocol_conformance - INFO - 更新后的端口列表: ['SE_ETH1']
2025-09-08 14:33:38,602 - test_protocol_conformance - INFO - 配置 rstp0 的RSTP
2025-09-08 14:33:41,984 - test_protocol_conformance - INFO - RSTP状态:
---- rstp0 ----
Root ID:
  stp-priority    32768
  stp-system-id   1a:52:99:6a:ed:44
  stp-hello-time  2s
  stp-max-age     6s
  stp-fwd-delay   4s
  This bridge is the root

Bridge ID:
  stp-priority    32768
  stp-system-id   1a:52:99:6a:ed:44
  stp-hello-time  2s
  stp-max-age     6s
  stp-fwd-delay   4s

  Interface  Role       State      Cost     Pri.Nbr 
  ---------- ---------- ---------- -------- -------


2025-09-08 14:33:41,985 - test_protocol_conformance - INFO - 确保网络拓扑配置正确
2025-09-08 14:33:41,985 - NetworkTopology - INFO - 创建RSTP环形拓扑...
2025-09-08 14:33:41,985 - NetworkTopology - INFO - 可用节点数量: 3
2025-09-08 14:33:41,985 - NetworkTopology - INFO - 开始配置节点 1/3: DUT
2025-09-08 14:33:41,985 - NetworkTopology - INFO - 为节点 DUT 配置RSTP网桥...
2025-09-08 14:33:41,986 - NetworkTopology - INFO - 开始为 DUT 检测RSTP支持方法...
2025-09-08 14:33:41,986 - NetworkTopology - INFO - DUT: 开始检测RSTP支持方法...
2025-09-08 14:33:41,986 - NetworkTopology - INFO - DUT: 检查OVS支持...
2025-09-08 14:33:42,032 - NetworkTopology - INFO - DUT: ovs-vsctl检查结果: code=0
2025-09-08 14:33:42,032 - NetworkTopology - INFO - DUT: 检查OVS服务状态...
2025-09-08 14:33:42,094 - NetworkTopology - INFO - DUT: OVS服务状态检查: code=0, output=active
2025-09-08 14:33:42,094 - NetworkTopology - INFO - DUT: 检测到OVS支持
2025-09-08 14:33:42,094 - NetworkTopology - INFO - DUT 使用方法: ovs
2025-09-08 14:33:42,094 - NetworkTopology - INFO - 清理 DUT 的旧网桥配置...
2025-09-08 14:33:42,443 - NetworkTopology - INFO - 为 DUT 配置RSTP (ovs)...
2025-09-08 14:33:42,444 - NetworkTopology - INFO - DUT: 使用OVS配置RSTP
2025-09-08 14:33:42,831 - NetworkTopology - INFO - DUT: RSTP已通过OVS配置
2025-09-08 14:33:42,831 - NetworkTopology - INFO - DUT RSTP核心配置完成
2025-09-08 14:33:42,831 - NetworkTopology - INFO - 为 DUT 添加接口: ['eth0', 'eth2']
2025-09-08 14:33:42,832 - NetworkTopology - INFO - 添加接口 eth0 到 DUT 的网桥
2025-09-08 14:33:43,058 - NetworkTopology - INFO - 添加接口 eth2 到 DUT 的网桥
2025-09-08 14:33:43,299 - NetworkTopology - INFO - DUT 接口添加完成
2025-09-08 14:33:43,300 - NetworkTopology - INFO - 启动 DUT 的网桥 rstp0...
2025-09-08 14:33:43,355 - NetworkTopology - INFO - 验证 DUT 的RSTP配置...
2025-09-08 14:33:43,451 - NetworkTopology - INFO - DUT 网桥配置验证完成
2025-09-08 14:33:43,452 - NetworkTopology - INFO - 节点 DUT RSTP配置完成
2025-09-08 14:33:43,452 - NetworkTopology - INFO - 开始配置节点 2/3: TestNode1
2025-09-08 14:33:43,452 - NetworkTopology - INFO - 为节点 TestNode1 配置RSTP网桥...
2025-09-08 14:33:43,452 - NetworkTopology - INFO - 开始为 TestNode1 检测RSTP支持方法...
2025-09-08 14:33:43,453 - NetworkTopology - INFO - TestNode1: 开始检测RSTP支持方法...
2025-09-08 14:33:43,453 - NetworkTopology - INFO - TestNode1: 检查mstpd支持...
2025-09-08 14:33:43,469 - NetworkTopology - INFO - TestNode1: mstpd检查结果: code=0
2025-09-08 14:33:43,469 - NetworkTopology - INFO - TestNode1: 检查mstpd服务状态...
2025-09-08 14:33:43,658 - NetworkTopology - INFO - TestNode1: mstpd服务状态: code=1, output=
2025-09-08 14:33:43,659 - NetworkTopology - INFO - TestNode1: 尝试启动mstpd服务...
2025-09-08 14:33:44,004 - NetworkTopology - INFO - TestNode1: mstpd启动命令结果: code=0, stderr=[sudo] admin 的密码：
2025-09-08 14:33:46,146 - NetworkTopology - INFO - TestNode1: mstpd启动后状态: code=1
2025-09-08 14:33:46,147 - NetworkTopology - INFO - TestNode1: mstpd启动失败，使用iproute2
2025-09-08 14:33:46,147 - NetworkTopology - INFO - TestNode1: 最终选择RSTP方法: iproute2
2025-09-08 14:33:46,147 - NetworkTopology - INFO - TestNode1 使用方法: iproute2
2025-09-08 14:33:46,147 - NetworkTopology - INFO - 清理 TestNode1 的旧网桥配置...
2025-09-08 14:33:47,243 - NetworkTopology - INFO - 为 TestNode1 配置RSTP (iproute2)...
2025-09-08 14:33:49,443 - NetworkTopology - INFO - TestNode1: RSTP已通过iproute2配置
2025-09-08 14:33:49,443 - NetworkTopology - INFO - TestNode1 RSTP核心配置完成
2025-09-08 14:33:49,444 - NetworkTopology - INFO - 为 TestNode1 添加接口: ['eth0', 'eth2']
2025-09-08 14:33:49,444 - NetworkTopology - INFO - 添加接口 eth0 到 TestNode1 的网桥
2025-09-08 14:33:50,154 - NetworkTopology - INFO - 添加接口 eth2 到 TestNode1 的网桥
2025-09-08 14:33:50,864 - NetworkTopology - INFO - TestNode1 接口添加完成
2025-09-08 14:33:50,864 - NetworkTopology - INFO - 启动 TestNode1 的网桥 br0...
2025-09-08 14:33:51,211 - NetworkTopology - INFO - 验证 TestNode1 的RSTP配置...
2025-09-08 14:33:51,278 - NetworkTopology - INFO - TestNode1: STP/RSTP已启用
2025-09-08 14:33:51,337 - NetworkTopology - INFO - TestNode1 网桥配置验证完成
2025-09-08 14:33:51,337 - NetworkTopology - INFO - 节点 TestNode1 RSTP配置完成
2025-09-08 14:33:51,338 - NetworkTopology - INFO - 开始配置节点 3/3: TestNode2
2025-09-08 14:33:51,338 - NetworkTopology - INFO - 为节点 TestNode2 配置RSTP网桥...
2025-09-08 14:33:51,338 - NetworkTopology - INFO - 开始为 TestNode2 检测RSTP支持方法...
2025-09-08 14:33:51,338 - NetworkTopology - INFO - TestNode2: 开始检测RSTP支持方法...
2025-09-08 14:33:51,338 - NetworkTopology - INFO - TestNode2: 检查mstpd支持...
2025-09-08 14:33:51,355 - NetworkTopology - INFO - TestNode2: mstpd检查结果: code=0
2025-09-08 14:33:51,356 - NetworkTopology - INFO - TestNode2: 检查mstpd服务状态...
2025-09-08 14:33:51,527 - NetworkTopology - INFO - TestNode2: mstpd服务状态: code=1, output=
2025-09-08 14:33:51,528 - NetworkTopology - INFO - TestNode2: 尝试启动mstpd服务...
2025-09-08 14:33:51,856 - NetworkTopology - INFO - TestNode2: mstpd启动命令结果: code=0, stderr=[sudo] admin 的密码：
2025-09-08 14:33:54,014 - NetworkTopology - INFO - TestNode2: mstpd启动后状态: code=1
2025-09-08 14:33:54,014 - NetworkTopology - INFO - TestNode2: mstpd启动失败，使用iproute2
2025-09-08 14:33:54,014 - NetworkTopology - INFO - TestNode2: 最终选择RSTP方法: iproute2
2025-09-08 14:33:54,015 - NetworkTopology - INFO - TestNode2 使用方法: iproute2
2025-09-08 14:33:54,015 - NetworkTopology - INFO - 清理 TestNode2 的旧网桥配置...
2025-09-08 14:33:55,094 - NetworkTopology - INFO - 为 TestNode2 配置RSTP (iproute2)...
2025-09-08 14:34:04,492 - NetworkTopology - INFO - TestNode2: RSTP已通过iproute2配置
2025-09-08 14:34:04,493 - NetworkTopology - INFO - TestNode2 RSTP核心配置完成
2025-09-08 14:34:04,493 - NetworkTopology - INFO - 为 TestNode2 添加接口: ['eth0', 'eth2']
2025-09-08 14:34:04,493 - NetworkTopology - INFO - 添加接口 eth0 到 TestNode2 的网桥
2025-09-08 14:34:05,175 - NetworkTopology - INFO - 添加接口 eth2 到 TestNode2 的网桥
2025-09-08 14:34:05,841 - NetworkTopology - INFO - TestNode2 接口添加完成
2025-09-08 14:34:05,841 - NetworkTopology - INFO - 启动 TestNode2 的网桥 br0...
2025-09-08 14:34:06,206 - NetworkTopology - INFO - 验证 TestNode2 的RSTP配置...
2025-09-08 14:34:06,271 - NetworkTopology - INFO - TestNode2: STP/RSTP已启用
2025-09-08 14:34:06,329 - NetworkTopology - INFO - TestNode2 网桥配置验证完成
2025-09-08 14:34:06,329 - NetworkTopology - INFO - 节点 TestNode2 RSTP配置完成
2025-09-08 14:34:06,330 - NetworkTopology - INFO - 环形拓扑创建完成
2025-09-08 14:34:11,331 - test_protocol_conformance - INFO - === 尝试捕获BPDU ===
2025-09-08 14:34:11,341 - test_protocol_conformance - INFO - 当前网桥端口: []
2025-09-08 14:34:11,341 - test_protocol_conformance - INFO - 尝试在 rstp0 上捕获BPDU...
2025-09-08 14:34:11,341 - RSTPAnalyzer_DUT - INFO - 开始捕获BPDU包 (接口: rstp0, 数量: 10)
2025-09-08 14:34:21,428 - RSTPAnalyzer_DUT - INFO - 捕获到 0 个BPDU包
2025-09-08 14:34:21,428 - test_protocol_conformance - INFO - 尝试在 any 上捕获BPDU...
2025-09-08 14:34:21,428 - RSTPAnalyzer_DUT - INFO - 开始捕获BPDU包 (接口: any, 数量: 20)
2025-09-08 14:34:21,539 - RSTPAnalyzer_DUT - INFO - 捕获到 0 个BPDU包
2025-09-08 14:34:21,540 - test_protocol_conformance - WARNING - tcpdump未捕获到BPDU，检查OVS内部状态
2025-09-08 14:34:21,589 - test_protocol_conformance - ERROR - OVS RSTP没有活动端口
2025-09-08 14:34:21,962 - RSTPTest - INFO - 测试完成: test_rstp_protocol_verification (耗时: 44.31秒)
2025-09-08 14:34:21,962 - RSTPTest - INFO - ============================================================

2025-09-08 14:34:21,963 - SSH_TestNode1 - INFO - SSH连接已关闭: TestNode1
2025-09-08 14:34:21,963 - SSH_TestNode2 - INFO - SSH连接已关闭: TestNode2
2025-09-08 14:34:21,964 - SSH_DUT - INFO - SSH连接已关闭: DUT
